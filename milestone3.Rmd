---
title: "milestone3"
author: "Moliehi Mokete"
date: '2022-11-02'
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r, include=T}
library(tidyverse)
library(readr)
library(janitor)
library(purrr)
library(stringr)
library(gridExtra)
library(psych)
```


```{r}
file_path1<-"https://raw.githubusercontent.com/PHW290/phw251_projectdata/main/euro_mpx_cases.csv"
monkey_pox <-read_csv(file_path1,na = c("", "NA", "*", "n/a"))%>% clean_names()
str(monkey_pox)
file_path2<-"https://raw.githubusercontent.com/PHW290/phw251_projectdata/main/euro_pop_denominators.csv" 
pop_denominator<- read.csv(file_path2,na = c("", "NA", "*", "n/a")) %>%
  clean_names() %>% 
  rename(country_code = geo)
str(pop_denominator)

file_path3<-"https://raw.githubusercontent.com/PHW290/phw251_projectdata/main/euro_census_stats.csv"
census_stats <- read.csv(file_path3,na = c("", "NA", "*", "n/a"))%>% 
  clean_names()
str(census_stats)

file_path4<-"https://raw.githubusercontent.com/PHW290/phw251_projectdata/main/world_country_regions.csv"
world_country_region <- read.csv(file_path4,na = c("", "NA", "*", "n/a"))%>%
  clean_names()
str(world_country_region)


```
\newpage
Subset rows or columns, as needed

```{r}
joined_df <- merge(monkey_pox, pop_denominator, by.x = "country_code", 
             by.y = "country_code", all.x = TRUE, all.y = FALSE)

sub_region_categories<-unique(joined_df$country_code)
sub_region_categories

world_country_region<-world_country_region%>%
  mutate(country_code= case_when(str_detect(alpha_2,"at")~"AT",
                          str_detect(alpha_2,"be")~"BE",
                          str_detect(alpha_2,"bg")~"BG",
                          str_detect(alpha_2,"cy")~"CY",
                          str_detect(alpha_2,"cz")~"CZ",
                          str_detect(alpha_2,"de")~"DE",
                          str_detect(alpha_2,"dk")~"DK",
                          str_detect(alpha_2,"ee")~"EE",
                          str_detect(alpha_2,"el")~"EL",
                          str_detect(alpha_2,"es")~"ES",
                          str_detect(alpha_2,"fi")~"FI",
                          str_detect(alpha_2,"fr")~"FR",
                          str_detect(alpha_2,"hr")~"HR",
                          str_detect(alpha_2,"hu")~"HU",
                          str_detect(alpha_2,"ie")~"IE",
                          str_detect(alpha_2,"is")~"IS",
                          str_detect(alpha_2,"it")~"IT",
                          str_detect(alpha_2,"lt")~"LT",
                          str_detect(alpha_2,"lu")~"lu",
                          str_detect(alpha_2,"lv")~"LV",
                          str_detect(alpha_2,"mt")~"MT",
                          str_detect(alpha_2,"nl")~"NL",
                          str_detect(alpha_2,"no")~"NO",
                          str_detect(alpha_2,"pl")~"PL",
                          str_detect(alpha_2,"pt")~"PT",
                          str_detect(alpha_2,"ro")~"RO",
                          str_detect(alpha_2,"se")~"SE",
                          str_detect(alpha_2,"si")~"SI",
                          str_detect(alpha_2,"sk")~"SK",
                         TRUE~NA_character_))
joined_df <- merge(joined_df, world_country_region, by.x = "country_code", 
             by.y = "country_code", all.x = TRUE, all.y = FALSE)

joined_df<- joined_df%>%
  select(country_code,date_rep,country_exp,conf_cases,time_period,sub_region)%>%
  filter(time_period==2022)
#joined_df1 <- merge(joined_df, census_stats, by.x = "country_code", 
             #by.y = "country_code", all.x = TRUE, all.y = FALSE)

```

Create new variables needed for analysis (minimum 2)
New variables should be created based on existing columns; for example
Calculating a rate
Combining character strings
If no new values are needed for final tables/graphs, please create 2 new variables anyway
```{r}
joined_df<- joined_df%>% mutate(month_rep= months(date_rep))%>%
  arrange(country_code, month_rep)%>%
  group_by(country_exp, month_rep)%>%
  mutate(total_conf_case = sum(conf_cases))
```
\newpage

Clean variables needed for analysis (minimum 2)
Examples
Recode invalid values
Handle missing fields
Recode categories

```{r}
 var_info <- data.frame(Variable = names(joined_df),
                      VariableType = sapply(joined_df, class),
                      MissingValues = sapply(joined_df, function(y) 
                        sum(length(which(is.na(y))))),
                      row.names = NULL)
var_info

missing_data<- subset(joined_df, is.na(joined_df$sub_region))
missing_data

joined_df<- joined_df%>%
  mutate(sub_region=ifelse(country_exp=="Greece","Southeast Europe",sub_region),
  sub_region=ifelse(country_exp=="Luxembourg","Northwestern Europe",sub_region))

```
\newpage
Data dictionary based on clean dataset (minimum 4 data elements), including:
Variable name
Data type
Description

```{r}
 
```
\newpage
One or more tables with descriptive statistics for 4 data element

```{r}

data_dict <- function(joined_df, print_table = "No")
desc_stats <- data.frame(Variable = names(joined_df), 
                           describe(joined_df)[c(2:5, 13, 8:10)], 
                           row.names = NULL)

 # Create the data dictionary
  d_dict <- merge(var_info, desc_stats, by = "Variable")
  d_dict <- d_dict %>% mutate_at(vars("mean":"range"), .fun = round, 2)
  
  d_dict <- d_dict %>%
    mutate(mean = ifelse(VariableType == "numeric" | VariableType == "integer", mean, ""),
           sd = ifelse(VariableType == "numeric" | VariableType == "integer", sd, ""),
           median = ifelse(VariableType == "numeric" | VariableType == "integer", median, ""),
           se = ifelse(VariableType == "numeric" | VariableType == "integer", se, ""),
           min = ifelse(VariableType == "numeric" | VariableType == "integer", min, ""),
           max = ifelse(VariableType == "numeric" | VariableType == "integer", max, ""),
           range = ifelse(VariableType == "numeric" | VariableType == "integer", range, ""))
   data_dict(d_dict,print_table = "Yes")
   d_dict
   
```

PDF that is professionally prepared for presentation
Each part of the milestone is clearly on one page (use \newpage to push to a new page)
Only the necessary information is outputted (you should suppress, for example, entire data frame outputs)
Use of headers and sub headers to create an organized document
